# Raddle Teams - Copilot Development Instructions

## Repository Overview

**Raddle Teams** is a team-based multiplayer word chain puzzle game inspired by raddle.quest. Players collaborate in real-time to solve word puzzles by connecting words through clever clues. This is a full-stack application with a modern tech stack.

### Key Technologies

- **Backend**: Python 3.11+ with FastAPI, SQLModel, SQLite, WebSockets
- **Frontend**: React 19 with TypeScript, Tailwind CSS v4, Vite
- **Build Tools**: Poetry (Python), npm (JavaScript), Vite (bundling)
- **Development**: Hot reload for both frontend and backend

### Repository Stats

- **Size**: Medium (~350 files including dependencies)
- **Type**: Full-stack web application with real-time multiplayer features
- **Languages**: Python (backend), TypeScript/JavaScript (frontend), JSON (config/data)
- **Target Runtime**: Web browsers + Python ASGI server

## Build and Development Commands

### Prerequisites Installation

**Required versions**:

- Python 3.11 or higher
- Node.js 23 or higher (required for Vite v7 compatibility)
- Poetry (install via `pip install poetry`)

### Initial Setup (Run Once)

```bash
# 1. Install Python dependencies (creates .venv virtual environment)
poetry install --sync

# 2. Install JavaScript dependencies
npm install

# 3. Build frontend for production (required before first server run)
npm run build
```

**‚ö†Ô∏è Always run `npm run build` before starting the server for the first time** - the backend serves the frontend from the `static/` directory.

### Development Workflow

#### Option 1: Full Application (Recommended)

```bash
# Start the complete application (serves both API + frontend)
npm run server
```

- Server: http://localhost:8000 (serves both frontend and API)
- API docs: http://localhost:8000/docs
- Takes ~2-3 seconds to start
- Features hot module reload for frontend changes

### Code Quality and Validation

#### Backend (Python)

```bash
# Lint check (very fast, <1 second)
npm run lint:python
# or
poetry run ruff check .

# Auto-format code
npm run format:python
# or
poetry run ruff format .

# Both checks together
npm run lint:python && npm run format:python
```

#### Frontend (JavaScript/TypeScript)

```bash
# TypeScript type checking (~2-3 seconds)
npm run type-check

# ESLint linting (~2-3 seconds, max 15 warnings allowed)
npm run lint

# Auto-fix linting issues
npm run lint:fix

# Prettier formatting check
npm run format:check

# Auto-format with Prettier
npm run format

# Run all checks
npm run check
```

#### Production Build

```bash
# Build frontend for production (~1-2 seconds)
npm run build

# Watch mode for continuous building during development
npm run build:watch
```

### Testing

**No test suite is currently implemented.** The README mentions `poetry run pytest` but pytest is not installed and no test files exist. When implementing tests:

- Backend: Add pytest to pyproject.toml dev dependencies
- Frontend: Consider adding Vitest or Jest
- Create test files following Python (`test_*.py`) and JS (`*.test.ts`) conventions

## Project Architecture and Layout

### Directory Structure

```
raddle.teams/
‚îú‚îÄ‚îÄ backend/              # FastAPI backend application
‚îÇ   ‚îú‚îÄ‚îÄ api/             # REST API endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lobby.py     # Player lobby endpoints (/api/lobby/*)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ lobby.py # Admin lobby endpoints (/api/admin/lobby/*)
‚îÇ   ‚îú‚îÄ‚îÄ database/        # Database layer
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py  # Database engine and session management
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py    # SQLModel database models (Player, Team, Game, Guess, Lobby)
‚îÇ   ‚îú‚îÄ‚îÄ websocket/       # WebSocket handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.py       # WebSocket route definitions (/ws/*)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ events.py    # WebSocket event handlers
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ managers.py  # WebSocket connection managers
‚îÇ   ‚îî‚îÄ‚îÄ dependencies.py  # FastAPI dependencies (auth, etc.)
‚îú‚îÄ‚îÄ frontend/            # React frontend application
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/  # Reusable React components (currently empty)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context/     # React context providers (player state)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/       # Custom React hooks (WebSocket)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/       # Main application pages (Home, Admin, Lobby, Game)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/    # API service layer
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/       # TypeScript type definitions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.tsx      # Main React application
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tsx     # React entry point
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.css    # Tailwind CSS imports
‚îÇ   ‚îî‚îÄ‚îÄ index.html       # HTML template
‚îú‚îÄ‚îÄ puzzles/             # Game puzzle definitions (JSON format)
‚îÇ   ‚îî‚îÄ‚îÄ tutorial.json    # Tutorial puzzle with word chain
‚îú‚îÄ‚îÄ static/              # Built frontend assets (generated by Vite)
‚îú‚îÄ‚îÄ main.py              # FastAPI application entry point
‚îú‚îÄ‚îÄ run.py               # Development server launcher
‚îú‚îÄ‚îÄ settings.py          # Application settings with admin password
‚îî‚îÄ‚îÄ custom_logging.py    # Application logging configuration
```

### Configuration Files

- `pyproject.toml` - Python dependencies and ruff configuration
- `package.json` - JavaScript dependencies and build scripts
- `vite.config.ts` - Vite build configuration (builds to `../static/`)
- `tailwind.config.ts` - Tailwind CSS configuration
- `tsconfig.json` - TypeScript compiler configuration
- `eslint.config.js` - ESLint linting rules and configuration
- `postcss.config.js` - PostCSS configuration for Tailwind

### Key Entry Points

- **Backend API**: `main.py` ‚Üí includes routers from `backend/api/lobby.py`, `backend/api/admin/lobby.py`, and `backend/websocket/api.py`
- **Frontend**: `frontend/src/main.tsx` ‚Üí renders `App.tsx`
- **Development Server**: `run.py` ‚Üí launches uvicorn with auto-reload
- **Settings**: `settings.py` ‚Üí contains admin password and other configuration

### Database Models (SQLModel/SQLite)

- **Player**: User session with name, session_id, lobby_id, optional team assignment
- **Lobby**: Game lobbies with unique codes that players join
- **Team**: Game teams with current progress tracking (linked to lobby and game)
- **Game**: Game instances with state (lobby/team_setup/active/finished)
- **Guess**: Player guess attempts with validation results

Database file: `database.db` (auto-created, excluded by .gitignore)

### API Architecture

**Current Phase 1 Implementation:**

#### Player Endpoints (`/api/lobby/*`)
- `POST /api/lobby/{lobby_code}/join` - Join a lobby (creates player if needed)
- `GET /api/lobby/{session_id}` - Get active lobby for player (for reconnection)
- `GET /api/lobby/{lobby_id}` - Get lobby info (lobby, players, teams)

#### Admin Endpoints (`/api/admin/lobby/*`) - Requires Bearer token
- `POST /api/admin/lobby` - Create a new lobby
- `GET /api/admin/lobby` - View all lobbies

#### WebSocket Endpoints (`/ws/*`)
- `/ws/admin/{web_session_id}?token={admin_token}` - Admin WebSocket connection
- `/ws/lobby/{lobby_id}/player/{player_session_id}` - Player WebSocket connection

### Authentication

- **Admin Authentication**: Bearer token in Authorization header or query parameter
- **Player Authentication**: Session ID stored in localStorage (user token placeholder)
- **Token Storage**: Frontend stores admin/user tokens in localStorage

### Frontend Pages

**Current Implementation:**
- **HomePage**: Lobby code input and player name entry
- **AdminPage**: Admin login, lobby creation, and lobby management
- **LobbyPage**: Player lobby view with lobby info and player list
- **GamePage**: Placeholder for future game functionality

**API Service:**
- Token-based authentication with localStorage
- Admin endpoints for lobby management
- Player endpoints for joining and viewing lobbies
- WebSocket connection handling

### Real-time Features

**Current Implementation:**
- WebSocket connections for admin monitoring
- Player lobby WebSocket connections  
- Connection managers for handling multiple sessions
- Basic disconnect/reconnect handling

**Planned for Later Phases:**
- Live team chat and progress updates
- Optimistic locking for simultaneous guesses
- Game state synchronization across clients

## Current Development Status

### Phase 1: Core Mechanics ‚úÖ (Partially Complete)

**‚úÖ Implemented:**
- Basic lobby system with unique codes
- Player join/creation functionality  
- Admin lobby management (create, view all, peek into lobbies)
- WebSocket infrastructure for admin and players
- Token-based admin authentication
- Database models and relationships

**üöß In Progress/Planned:**
- Team assignment functionality
- Single puzzle solving with optimistic locking
- Real-time game state updates

### Phase 2: Competition Features (Planned)

- Multiple puzzles + progress tracking
- Enhanced admin controls + team management
- Win conditions and game flow

### Phase 3: Polish (Planned)

- Hint system + elimination mechanics
- Robust reconnection handling
- Enhanced admin dashboard with analytics

## Development Tips

### Common Issues and Solutions

1. **Frontend not loading**: Always run `npm run build` after frontend changes in production mode
2. **Module import errors**: Ensure virtual environment is activated via poetry commands
3. **Port conflicts**: Default ports are 8000 (backend) and 5173 (frontend dev)
4. **Build timing**: Frontend build takes 1-2 seconds, backend linting is under 1 second
5. **Vite not found**: If `npm run build` fails with "vite: not found", the issue is usually with the PATH in that terminal session. Use `npx vite build` as a workaround or start a fresh terminal session.
6. **Dependencies out of sync**: If you encounter import errors, run `poetry install --sync && npm install` to ensure all dependencies are properly installed

### Making Changes

1. **Backend changes**: Files auto-reload when using `npm run server`
2. **Frontend changes**: Hot module reload automatically updates the browser when frontend files change
3. **Database changes**: Delete `raddle_teams.db` to reset (auto-recreated)

### File Locations for Common Tasks

- **Add API endpoint**: `backend/api/lobby.py` (player) or `backend/api/admin/lobby.py` (admin)
- **Add database model**: `backend/database/models.py`
- **Add WebSocket handler**: `backend/websocket/events.py` or `backend/websocket/managers.py`
- **Add React component**: `frontend/src/components/`
- **Add new page**: `frontend/src/pages/`
- **Add puzzle**: `puzzles/*.json`
- **Update settings**: `settings.py` (admin password, etc.)
- **Styling**: Uses Tailwind CSS classes directly in JSX

### Environment Setup

- **Logs**: Application logs to `raddle_teams.log` (excluded by .gitignore)
- **Static files**: Built frontend goes to `static/` (excluded by .gitignore)
- **Virtual environment**: Poetry creates `.venv/` (excluded by .gitignore)
- **Admin password**: Set in `settings.py` or via `.env` file

## Key Files Reference

### Root Directory Files

- `.gitignore` - Excludes build artifacts, logs, databases, node_modules
- `LICENSE` - MIT License
- `README.md` - User documentation with setup instructions
- `poetry.lock` - Locked Python dependency versions
- `package-lock.json` - Locked JavaScript dependency versions

### Game Logic

- `puzzles/tutorial.json` - Example word chain: DOWN ‚Üí SOUTH ‚Üí MOUTH ‚Üí TONGUE ‚Üí SHOE ‚Üí SOLE ‚Üí SOUL ‚Üí HEART ‚Üí EARTH
- Game logic implementation is planned for later phases
- Current focus is on lobby and player management infrastructure

**Trust these instructions** - they are comprehensive and tested. Only search for additional information if something is incomplete or incorrect.
