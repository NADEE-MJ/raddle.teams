# Raddle Teams - Copilot Development Instructions

## Repository Overview

**Raddle Teams** is a team-based multiplayer word chain puzzle game inspired by raddle.quest. Players collaborate in real-time to solve word puzzles by connecting words through clever clues. This is a full-stack application with a modern tech stack.

### Key Technologies

- **Backend**: Python 3.11+ with FastAPI, SQLModel, SQLite, WebSockets
- **Frontend**: React 18 with TypeScript, Tailwind CSS v4, Vite
- **Build Tools**: Poetry (Python), npm (JavaScript), Vite (bundling)
- **Development**: Hot reload for both frontend and backend

### Repository Stats

- **Size**: Medium (~350 files including dependencies)
- **Type**: Full-stack web application with real-time multiplayer features
- **Languages**: Python (backend), TypeScript/JavaScript (frontend), JSON (config/data)
- **Target Runtime**: Web browsers + Python ASGI server

## Build and Development Commands

### Prerequisites Installation

**Required versions**:

- Python 3.11 or higher
- Node.js 20.19 or higher (required for Vite compatibility)
- Poetry (install via `pip install poetry`)

### Initial Setup (Run Once)

```bash
# 1. Install Python dependencies (creates .venv virtual environment)
poetry install

# 2. Install JavaScript dependencies
npm install

# 3. Build frontend for production (required before first server run)
npm run build
```

**⚠️ Always run `npm run build` before starting the server for the first time** - the backend serves the frontend from the `static/` directory.

### Development Workflow

#### Option 1: Full Application (Recommended)

```bash
# Start the complete application (serves both API + frontend)
poetry run python run.py
```

- Server: http://localhost:8000 (serves both frontend and API)
- API docs: http://localhost:8000/docs
- Takes ~2-3 seconds to start

#### Option 2: Split Development

```bash
# Terminal 1: Backend only
poetry run python run.py

# Terminal 2: Frontend dev server (optional, for faster frontend iteration)
npx vite
# Note: Use npx vite instead of npm run dev - the dev script is not defined in package.json
```

- Backend: http://localhost:8000
- Frontend dev: http://localhost:5173 (starts in ~500ms)

### Code Quality and Validation

#### Backend (Python)

```bash
# Lint check (very fast, <1 second)
poetry run ruff check .

# Auto-format code
poetry run ruff format .

# Both checks together
poetry run ruff check . && poetry run ruff format .
```

#### Frontend (JavaScript/TypeScript)

```bash
# TypeScript type checking (~2-3 seconds)
npm run type-check

# ESLint linting (~2-3 seconds, max 15 warnings allowed)
npm run lint

# Auto-fix linting issues
npm run lint:fix

# Prettier formatting check
npm run format:check

# Auto-format with Prettier
npm run format

# Run all checks
npm run check
```

#### Production Build

```bash
# Build frontend for production (~1-2 seconds)
npm run build

# Watch mode for continuous building during development
npm run build:watch
```

### Testing

**No test suite is currently implemented.** The README mentions `poetry run pytest` but pytest is not installed and no test files exist. When implementing tests:

- Backend: Add pytest to pyproject.toml dev dependencies
- Frontend: Consider adding Vitest or Jest
- Create test files following Python (`test_*.py`) and JS (`*.test.ts`) conventions

## Project Architecture and Layout

### Directory Structure

```
raddle.teams/
├── backend/              # FastAPI backend application
│   ├── api.py           # REST API endpoints (/api/*)
│   ├── database.py      # SQLModel database models (Player, Team, Game, Guess)
│   ├── game_logic.py    # Core game mechanics and puzzle logic
│   ├── schemas.py       # Pydantic request/response models
│   └── websocket.py     # WebSocket handlers (/ws/*) for real-time features
├── frontend/            # React frontend application
│   ├── src/
│   │   ├── components/  # Reusable React components
│   │   ├── context/     # React context providers (game state)
│   │   ├── hooks/       # Custom React hooks
│   │   ├── pages/       # Main application pages (Player, Admin)
│   │   ├── services/    # API service layer
│   │   ├── types/       # TypeScript type definitions
│   │   ├── App.tsx      # Main React application
│   │   ├── main.tsx     # React entry point
│   │   └── index.css    # Tailwind CSS imports
│   └── index.html       # HTML template
├── puzzles/             # Game puzzle definitions (JSON format)
│   └── tutorial.json    # Tutorial puzzle with word chain
├── static/              # Built frontend assets (generated by Vite)
├── main.py              # FastAPI application entry point
├── run.py               # Development server launcher
└── custom_logging.py    # Application logging configuration
```

### Configuration Files

- `pyproject.toml` - Python dependencies and ruff configuration
- `package.json` - JavaScript dependencies and build scripts
- `vite.config.ts` - Vite build configuration (builds to `../static/`)
- `tailwind.config.ts` - Tailwind CSS configuration
- `tsconfig.json` - TypeScript compiler configuration
- `eslint.config.js` - ESLint linting rules and configuration
- `postcss.config.js` - PostCSS configuration for Tailwind

### Key Entry Points

- **Backend API**: `main.py` → includes routers from `backend/api.py` and `backend/websocket.py`
- **Frontend**: `frontend/src/main.tsx` → renders `App.tsx`
- **Development Server**: `run.py` → launches uvicorn with auto-reload

### Database Models (SQLModel/SQLite)

- **Player**: User session with name, session_id, team assignment
- **Team**: Game teams with current progress tracking
- **Game**: Game instances with state (lobby/team_setup/active/finished)
- **Guess**: Player guess attempts with validation results

Database file: `raddle_teams.db` (auto-created, excluded by .gitignore)

### API Architecture

- **Player endpoints**: `/api/players/*` - join game, manage sessions
- **Admin endpoints**: `/api/admin/*` - game management, team assignment
- **WebSocket**: `/ws/{player_id}` - real-time updates and team communication
- **Health check**: `/api/health` - server status

### Real-time Features

- WebSocket connections for each player
- Live team chat and progress updates
- Optimistic locking prevents race conditions on simultaneous guesses
- State synchronization across all connected clients

## Development Tips

### Common Issues and Solutions

1. **Frontend not loading**: Always run `npm run build` after frontend changes in production mode
2. **Module import errors**: Ensure virtual environment is activated via poetry commands
3. **Port conflicts**: Default ports are 8000 (backend) and 5173 (frontend dev)
4. **Build timing**: Frontend build takes 1-2 seconds, backend linting is under 1 second
5. **Vite not found**: If `npm run build` fails with "vite: not found", the issue is usually with the PATH in that terminal session. Use `npx vite build` as a workaround or start a fresh terminal session.
6. **Dependencies out of sync**: If you encounter import errors, run `poetry install && npm install` to ensure all dependencies are properly installed

### Making Changes

1. **Backend changes**: Files auto-reload when using `poetry run python run.py`
2. **Frontend changes**:
   - In dev mode (`npx vite`): Instant hot reload
   - In production mode: Requires `npm run build` to see changes
3. **Database changes**: Delete `raddle_teams.db` to reset (auto-recreated)

### File Locations for Common Tasks

- **Add API endpoint**: `backend/api.py`
- **Add database model**: `backend/database.py`
- **Add game logic**: `backend/game_logic.py`
- **Add React component**: `frontend/src/components/`
- **Add new page**: `frontend/src/pages/`
- **Add puzzle**: `puzzles/*.json`
- **Styling**: Uses Tailwind CSS classes directly in JSX

### Environment Setup

- **Logs**: Application logs to `raddle_teams.log` (excluded by .gitignore)
- **Static files**: Built frontend goes to `static/` (excluded by .gitignore)
- **Virtual environment**: Poetry creates `.venv/` (excluded by .gitignore)

## Key Files Reference

### Root Directory Files

- `.gitignore` - Excludes build artifacts, logs, databases, node_modules
- `LICENSE` - MIT License
- `README.md` - User documentation with setup instructions
- `poetry.lock` - Locked Python dependency versions
- `package-lock.json` - Locked JavaScript dependency versions

### Game Logic

- `backend/game_logic.py` - Contains `GameManager` class with puzzle loading and team progress tracking
- `puzzles/tutorial.json` - Example word chain: DOWN → SOUTH → MOUTH → TONGUE → SHOE → SOLE → SOUL → HEART → EARTH

**Trust these instructions** - they are comprehensive and tested. Only search for additional information if something is incomplete or incorrect.
